<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<style type="text/css">
	@import "../../../../dojo-1.6.1rc2/dojo/resources/dojo.css";
	@import "../../../../dojo-1.6.1rc2/dijit/themes/dijit.css";
	@import "../../../../dojo-1.6.1rc2/dijit/themes/soria/soria.css";
	@import "../../../../dojo-1.6.1rc2/dijit/themes/tundra/tundra.css";
</style>

<link rel="stylesheet" href="plugins/core/css/toolbar.css">

<title>t.plugins.admin.parameters.test</title>

<script type="text/javascript"
	src="../../../../dojo-1.6.1rc2/dojo/dojo.js"
	djConfig="parseOnLoad: true, isDebug: false, locale: ''"></script>	

<!--<script type="text/javascript" src="builds/011-workflow/dojo/workflow.js.uncompressed.js"></script>-->

<script type="text/javascript" src="../../../../builds/012-admin/dojo/admin.js.uncompressed.js"></script>

<script type="text/javascript">

// REGISTER module path FOR PLUGINS
dojo.registerModulePath("plugins","../../plugins");	
dojo.registerModulePath("t","../../t");	

// DOJO TEST MODULES
//dojo.require("dijit.dijit");
////dojo.require("dojox.robot.recorder");
////dojo.require("dijit.robot");
dojo.require("doh.runner");
dojo.require("dojo.parser");

// Agua TEST MODULES
dojo.require("t.doh.util");
dojo.require("dojoc.util.loader");

// TESTED MODULES
dojo.require("plugins.core.Agua");
dojo.require("dojo.dnd.Source");
dojo.require("plugins.admin.Parameters");

var Agua;
var Data;
var data;


var modules = {
// LEFT PANE
	"apps"			: "Apps",
	"groupprojects"	:	"GroupProjects",
	"settings"		:	"Settings",
	"clusters"		:	"Clusters",
	
	// MIDDLE PANE
	"parameters"	:	"Parameters",
	"groups"		:	"Groups",
	"projects"		:	"Projects",
	"access"		:	"Access",
	
	// RIGHT PANE
	"groupsources"	:	"GroupSources",
	"groupusers"	:	"GroupUsers",
	"sources"		:	"Sources",
	"users"			:	"Users"
};

var getUsername = function () {
	if ( ! url.match(/(.+?)\?([^\?]+),([^,]+)/) )
		return false;
	return url.match(/(.+?)\?([^\?]+?),([^,]+)/)[2];
};

var getSessionId = function () {
	if ( ! url.match(/(.+?)\?([^\?]+),([^,]+)/) )
		return false;
	return url.match(/(.+?)\?([^\?]+?),([^,]+)/)[3];
};

var getHeadings = function () {
// GET USERNAME, SESSIONID AND MODULES INFO FROM URL 
	console.log("getHeadings    plugins.core.getHeadings()");
	var url = window.location.href;
	console.log("getHeadings    url: " + url);

	if ( ! url.match(/(.+?)\?([^\?]+),([^,]+),([^,]+)$/) )
		return false;

	var plugins = url.match(/(.+?)\?([^\?]+),([^,]+),([^,]+)$/)[4];
	console.log("getHeadings    plugins: " + dojo.toJson(plugins));

	var headings = new Object;
	var array = plugins.split(/\./);
	console.log("getHeadings    array: " + dojo.toJson(array));
	for ( var i = 0; i < array.length; i++ )
	{
		var info = array[i].split(/:/);
		var side = info[0];
		var name = info[1];
		console.log("getHeadings    side: " + dojo.toJson(side));
		console.log("getHeadings    name: " + dojo.toJson(name));
		var pane = side + "Pane";
		if ( headings[pane] == null )
			headings[pane] = new Array;
		
		var module = modules[name];
		console.log("getHeadings    module: " + dojo.toJson(module));
		headings[pane].push(module);
	}
	console.log("getHeadings    headings: " + dojo.toJson(headings));

	return headings;
};

	
dojo.addOnLoad(function(){

	Agua = new plugins.core.Agua( {
		cgiUrl : "../../../../../../cgi-bin/agua/",
		htmlUrl : "../../../../agua/",
		dataUrl: "../../../t/json/getData.json"
	});

	data = t.doh.util.fetchJson("../../../../t/json/getData-110804-admin.json");
	Agua.loadData(data);	

	console.log("Doing getHeadings()");
	Agua.data.headings = getHeadings();
	

	Agua.loadPlugins([ "plugins.admin.Controller" ]);
	
//	Admin = new plugins.admin.Controller({
//		headings : headings
//	});
//
//	var tabContainer = new dijit.layout.TabContainer({
//            style: "height: 100%; width: 100%;"
//	    },
//        "tabContainer");
//	dojo.attr(tabContainer.domNode, "class", "admin");
//	Agua.tabs.addChild(tabContainer);



	//var parameters = new plugins.admin.Parameters({
	//	tabContainer : tabContainer
	//});	

	
}); // dojo.addOnLoad

	
</script>

</head>
<!--<body class="claro">-->
<body class="agua tundra claro">

	<div id="attachPoint" ></div>

	<!-- ADMIN LEFT PANE -->
	<div
		dojoAttachPoint="leftPane"
		layoutAlign="left" 
		dojoType="dijit.layout.ContentPane" 
		style="position: absolute !important; width: 390px; height: 100% !important; max-height: auto !important; min-width: 25px; background: #FFF; padding: 0; border: none !important;"
	>
		<!-- LEFT TAB CONTAINER-->
		<div dojoAttachPoint="leftTabContainer"
			id="tabContainer"
			style="height: 100%; overflow: visible;"
			class="admin"
		>
		</div>
		<!-- END LEFT TAB CONTAINER-->
	</div>

</body>
</html>
